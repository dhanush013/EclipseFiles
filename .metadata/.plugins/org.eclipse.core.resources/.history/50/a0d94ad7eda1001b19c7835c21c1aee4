package com.cts.emp.util;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

import java.util.Properties;

import com.cts.emp.exception.EmployeeSystemAdminException;
import com.cts.emp.dao.DbConstants;
import java.sql.PreparedStatement;


public class DBConnectionManager {
	private static DBConnectionManager instance;
	
	private static Connection connection = null;
	private static Properties dbProperties = null;

	public DBConnectionManager() throws EmployeeSystemAdminException {
		loadProperties();
	}

	public static DBConnectionManager getInstance() throws EmployeeSystemAdminException {
		if(instance == null){
			instance = new DBConnectionManager();
		}
		return instance;
	}

	public Connection getConnection() {
		try {
			Class.forName(dbProperties.getProperty(DbConstants.DRIVER_CLASS));
			connection = DriverManager.getConnection(
					dbProperties.getProperty(DbConstants.URL),
					dbProperties.getProperty(DbConstants.USERNAME),
					dbProperties.getProperty(DbConstants.PASSWORD)
				);
		} catch(ClassNotFoundException | SQLException e) {
			System.out.println(e.getMessage());
		}
		return connection;
	}

	public void loadProperties() throws EmployeeSystemAdminException {
		try(FileInputStream fis = new FileInputStream(DbConstants.PROPERTIES_FILE)) {
			dbProperties = new Properties();
			dbProperties.load(fis);
		} catch(FileNotFoundException e) {
			throw new EmployeeSystemAdminException(e.getMessage());
		} catch(IOException e) {
			throw new EmployeeSystemAdminException(e.getMessage());
		}
	}
	
}
